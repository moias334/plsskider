local TweenService = game:GetService("TweenService")

-- H√†m Tween ƒë·ªÉ bay m∆∞·ª£t
function topos(Pos)
    local player = game.Players.LocalPlayer
    local char = player.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    local humanoid = char and char:FindFirstChildOfClass("Humanoid")

    if not hrp or not humanoid then return end
    if humanoid.Sit then humanoid.Sit = false end

    local distance = (Pos.Position - hrp.Position).Magnitude
    local speed = 300 -- T·ªëc ƒë·ªô bay ch·∫≠m h∆°n ƒë·ªÉ tr√°nh vƒÉng
    local duration = distance / speed

    -- Ki·ªÉm tra n·∫øu ƒëang bay th√¨ h·ªßy tween c≈©
    if _G.CurrentTween then
        _G.CurrentTween:Cancel()
    end

    -- T·∫°o tween m·ªõi
    local tweenInfo = TweenInfo.new(duration, Enum.EasingStyle.Linear)
    local tween = TweenService:Create(hrp, tweenInfo, {CFrame = Pos})
    _G.CurrentTween = tween

    -- B·∫Øt ƒë·∫ßu bay
    tween:Play()

    -- Gi·ªØ nh√¢n v·∫≠t kh√¥ng b·ªã r·ªõt
    spawn(function()
        while tween.PlaybackState == Enum.PlaybackState.Playing do
            if _G.StopTween then
                tween:Cancel()
                _G.CurrentTween = nil
                return
            end

            hrp.Velocity = Vector3.new(0, 50, 0) -- Duy tr√¨ ƒë·ªô cao

            task.wait(0.1)
        end
    end)

    -- ƒê·∫£m b·∫£o v·ªã tr√≠ cu·ªëi c√πng ch√≠nh x√°c
    tween.Completed:Wait()
    if not _G.StopTween then
        hrp.CFrame = Pos
    end
end

-- Bay ƒë·∫øn ƒë·∫£o
_G.MysticIsland = true
spawn(function()
    while wait(1) do
        if _G.MysticIsland then
            local mysticIsland = game:GetService("Workspace").Map:FindFirstChild("MysticIsland")
            if mysticIsland then
                local position = mysticIsland.WorldPivot.Position
                topos(CFrame.new(position.X, position.Y + 100, position.Z)) -- Bay cao h∆°n tr√°nh r·ªõt
                _G.MysticIsland = false
                wait(2)
                _G.AutoLockMoon = true
            end
        end
    end
end)

-- T·ª± ƒë·ªông nh√¨n l√™n trƒÉng
spawn(function()
    while wait(1) do
        pcall(function()
            if _G.AutoLockMoon then
                local moonDir = game.Lighting:GetMoonDirection()
                local lookAtPos = game.Workspace.CurrentCamera.CFrame.p + moonDir * 100
                game.Workspace.CurrentCamera.CFrame = CFrame.lookAt(game.Workspace.CurrentCamera.CFrame.p, lookAtPos)
            end
        end)
    end
end)

-- B·∫≠t ph√≠m T ƒë·ªÉ k√≠ch ho·∫°t t·ªôc V3
spawn(function()
    while wait(1) do
        pcall(function()
            if _G.AutoLockMoon then
                game:GetService("VirtualInputManager"):SendKeyEvent(true, "T", false, game)
                wait(0.1)
                game:GetService("VirtualInputManager"):SendKeyEvent(false, "T", false, game)
                print("üü¢")

                -- ƒê·ª£i 5 gi√¢y tr∆∞·ªõc khi bay ƒë·∫øn b√°nh rƒÉng
                wait(5)
                _G.AutoLockMoon = false
                _G.TweenMGear = true
            end
        end)
    end
end)

-- Bay ƒë·∫øn b√°nh rƒÉng tr√™n ƒë·∫£o
_G.TweenMGear = false
spawn(function()
    while wait(1) do
        if _G.TweenMGear then
            local mysticIsland = game:GetService("Workspace").Map:FindFirstChild("MysticIsland")
            if mysticIsland then
                for _, v in pairs(mysticIsland:GetChildren()) do
                    if v:IsA("MeshPart") and v.Material == Enum.Material.Neon then
                        print("üü¢")
                        topos(v.CFrame)
                        _G.TweenMGear = false
                    end
                end
            end
        end
    end
end)
